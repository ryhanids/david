<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Masaxmas — david D ongkes</title>
  <style>
    body {font-family:system-ui,Segoe UI,Arial;background:#f3f4f6;padding:24px}
    .card {background:#fff;padding:18px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.06);max-width:720px;margin:16px auto}
    button {padding:10px 14px;border-radius:8px;border:none;background:#4f46e5;color:#fff;cursor:pointer}
    button:disabled {opacity:0.6;cursor:not-allowed}
    pre {background:#0b1220;color:#e6eef8;padding:12px;border-radius:6px;overflow:auto}
    #inbox {margin-top:16px;}
  </style>
</head>
<body>
  <div class="card">
    <h2>Masaxmas — Temporary Email</h2>
    <p>Buat email sementara dan lihat inbox.</p>
    <button id="btnGen">Generate Email</button>

    <div id="emailArea" style="margin-top:12px;display:none;">
      <p><strong>Email:</strong> <span id="emailText"></span></p>
      <p><strong>Password:</strong> <span id="passText"></span></p>
      <button id="btnPoll">Cek Inbox</button>
    </div>

    <h3>Inbox</h3>
    <div id="inbox">Belum ada email.</div>
  </div>

<script>
  const backend = "https://5278183.my.id/proxy.php";

  // Fungsi buat akun baru
  async function createAccount() {
    try {
      // Ambil domain random dari mail.tm
      const domainsRes = await fetch(backend + "?endpoint=/domains");
      const domainsData = await domainsRes.json();

      if (!domainsData["hydra:member"] || domainsData["hydra:member"].length === 0) {
        throw new Error("Tidak ada domain tersedia");
      }

      const domain = domainsData["hydra:member"][0].domain;
      const username = Math.random().toString(36).substring(2, 10) + "@" + domain;
      const password = Math.random().toString(36).substring(2, 12);

      // Buat akun di mail.tm
      const res = await fetch(backend + "?endpoint=/accounts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          address: username,
          password: password
        })
      });

      const data = await res.json();
      console.log("Akun:", data);

      document.getElementById("emailText").textContent = username;
      document.getElementById("passText").textContent = password;
      document.getElementById("emailArea").style.display = "block";

      return { username, password };
    } catch (err) {
      console.error("Gagal buat akun:", err);
      alert("Gagal generate email");
      return null;
    }
  }

  // Tombol generate
  document.getElementById("btnGen").addEventListener("click", async () => {
    const btn = document.getElementById("btnGen");
    btn.disabled = true; btn.textContent = "Generating...";
    await createAccount();
    btn.disabled = false; btn.textContent = "Generate Email";
  });

  // Tombol cek inbox
  document.getElementById("btnPoll").addEventListener("click", async () => {
    const email = document.getElementById("emailText").textContent;
    const password = document.getElementById("passText").textContent;
    if (!email || !password) return alert("Email/password belum tersedia");

    try {
      // Login dulu untuk dapat token
      const loginRes = await fetch(backend + "?endpoint=/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: email, password: password })
      });
      const loginData = await loginRes.json();

      if (!loginData.token) {
        throw new Error("Gagal login");
      }

      // Ambil inbox pakai token
      const inboxRes = await fetch(backend + "?endpoint=/messages", {
        headers: { "Authorization": "Bearer " + loginData.token }
      });
      const inboxData = await inboxRes.json();

      document.getElementById("inbox").innerHTML = `<pre>${JSON.stringify(inboxData, null, 2)}</pre>`;
    } catch (e) {
      alert("Gagal fetch inbox");
      console.error(e);
    }
  });
</script>
</body>
</html>
